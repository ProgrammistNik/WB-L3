## delayed-notifier
Сервис отложенных уведомлений с использованием RabbitMQ и Go.

### [Задание](./docs/task.md)


## Описание

`delayed-notifier` — DelayedNotifier — сервис, который принимает запросы на отправку уведомлений, сохраняет их в очередь через RabbitMQ и автоматически отправляет в указанное время. Реализованы повторные попытки доставки при сбоях, HTTP API и базовый веб-интерфейс для ручного тестирования.

---

## Технологии

- **Go** - основной язык разработки
- **RabbitMQ** — брокер сообщений
- **gin** — веб-фреймворк
- **Docker + Docker Compose** — контейнеризация и запуск окружения
- **HTML + JS** — простой UI для отправки и отслеживания уведомлений

---

## Функциональность

- API для работы с уведомлениями:
- `POST /notify` — создать уведомление с будущим временем отправки.
- `GET /notify/:id` — получить статус уведомления.
- `DELETE /notify/:id` — отменить запланированное уведомление.
- Планирование сообщений через очередь RabbitMQ.
- Повторная отправка при ошибке с экспоненциальной задержкой.
- Поддержка отправки в будущем (вплоть до дней и часов).
- Простой HTML-интерфейс для отправки и проверки уведомлений.

---

## Начало работы
### Установка
Клонирование репозитория
```sh
git clone https://github.com/ProgrammistNik/WB-L3/tree/main/l3.1_DelayedNotifier
```
### Запуск сервиса
Запускаем контейнер с помощью Makefile
```sh
make run
```
### Запуск тестов
Проверка vet, lint, data race, unit-тестов
```
make check
```
отдельный запуск unit-тестов c покрытием
```
make test
```

### Просмотр веб-интерфейса

**Основная страница:** [`http://localhost:8080/ui`](http://localhost:8080/ui)

Возможности:

- Создание уведомления (сообщение + время отправки)
- Отображение ID созданного уведомления
- Проверка его статуса
- Удаление (отмена) по ID

### Просмотр RabbitMQ

Для мониторинга RabbitMQ используется `RabbitMQ UI` — удобный веб-интерфейс.

**Открыть RabbitMQ UI:** [`http://localhost:15672`](http://localhost:15672)

***Логин / пароль:*** `guest` / `guest`

Можно просматривать очереди, сообщения, подтверждения, статус обработчиков и т.д.

### Формат запросов
#### создание события
Заходим на основную веб-старницу и создаем сообщение
и в поле пишим сообщени и нажав на календарь выставляем дату отправки 
уведомления
![Создать уведомление](docs/image/Создать%20уведомление.png)

после этого жмем создать и в поле `Ответ от сервера` получаем ответ
из поля `id` копируем его и вставляем в поле `Проверить статус`.

Статусы:
- `scheduled` - уведомление в обработке 
- `processed` - уведомление обработано
- `canceled` - уведомление отменено

![Проверить статус](docs/image/Проверить%20статус.png)

Если необходимо удалить запланированное уведомление, то в поле 
`Удалить уведомление` вставляем `id` и жмем кнопку `удалить`
![Удалить уведомление](docs/image/Удалить%20уведомление.png)

В поле `Ответ от сервера` мы получаем разные ответы от сервера
![Ответ от сервера](docs/image/Ответ%20от%20сервера.png)

#### создание события с помощью `curl` запросов 
Создание уведомления
```
curl -X POST http://localhost:8080/notify \
-H "Content-Type: application/json" \
-d '{
  "message": "Напоминание о встрече",
  "send_at": "2026-09-29T13:05:00Z"
}'
```
ответ
```
{"result":{"id":"c9bcfcd7-66de-462d-83e5-117c8d13a19e","status":"scheduled"}}%
```
Проверить статус
```
curl http://localhost:8080/notify/<notification_id>
```
ответ
```
{"result":{"id":"<notification_id>","status":"notification_status"}}% 
```
Отменить уведомление
```
curl -X DELETE http://localhost:8080/notify/<notification_id>
```
ответ
```
{"result":{"status":"canceled"}}% 
```